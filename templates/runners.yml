include:
  - project: donaldrich/gitlab-ci-templates
    file: function/notifications/pushover/docker-build.yml
  - project: donaldrich/gitlab-ci-templates
    file: function/docker/default.yml
  - project: donaldrich/gitlab-ci-templates
    file: function/notifications/healthchecks/docker-build.yml
  - project: donaldrich/gitlab-ci-templates
    file: function/docker/lint.yml

build:
  extends:
    - .dockerhub:monoarch:load

validate:
  image: donaldrich/private:docker-runner
  variables:
    GIT_STRATEGY: none
  stage: test
  script:
    - docker run $CI_REGISTRY_IMAGE/$IMAGE_NAME/$IMAGE_TAG:$CI_PIPELINE_ID validate
  needs: ["build"]

push:
  variables:
    GIT_STRATEGY: none
  extends:
    - .push:to:dockerhub
  needs: ["validate"]