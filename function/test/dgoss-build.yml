dgoss-run:
  image:
    name: donaldrich/function:dgoss
    entrypoint: [""]
  stage: validate
  variables:
    GOSS_FILES_PATH: DOCKER_BUILD_DIR
    GOSS_FILE: goss.yaml
    CONTAINER_LOG_OUTPUT: reports/$IMAGE_NAME/$IMAGE_TAG.log
    GOSS_FILES_STRATEGY: cp
  artifacts:
    name: "goss"
    paths:
      - $CI_PROJECT_DIR/reports/
    when: always
  before_script:
    - mkdir -p reports
    - ls
  script:
    - docker pull donaldrich/$IMAGE_NAME:$IMAGE_TAG
    - dgoss run donaldrich/$IMAGE_NAME:$IMAGE_TAG
  # rules:
  #   - exists:
  #     - "**/*/goss.yml"
  #     when: always
  #   - when: never

.dgoss-template:
  image:
    name: donaldrich/function:dgoss
    entrypoint: [""]
  stage: validate
  variables:
    GOSS_FILES_PATH: Dockerfiles/$IMAGE_TAG
    GOSS_FILES_STRATEGY: cp
    GIT_STRATEGY: none
    # CONTAINER_LOG_OUTPUT: Dockerfiles/$IMAGE_TAG/goss.log
  script:
    - docker pull donaldrich/$IMAGE_NAME:$IMAGE_TAG
    - dgoss run donaldrich/$IMAGE_NAME:$IMAGE_TAG
  # rules:
  #   - exists:
  #     - "**/*/goss.yml"
  #     when: always
  #   - when: never