update-repo:
  image:
    name: $CI_REGISTRY/$CI_PROJECT_NAMESPACE/secrets/private/docker-runner:latest
    entrypoint: [""]
  stage: .post
  variables:
    GIT_STRATEGY: fetch
  before_script:
    - rm -r public/ || true
  script:
    # - apk add git
    - ./run-all.sh
    - git config --global user.email $GITLAB_USER_EMAIL
    - git config --global user.name $GITLAB_USER_NAME
    - git config --global user.username $GITLAB_USER_LOGIN
    - git remote set-url --push origin $CI_REPOSITORY_URL
    - git remote show origin
    - git add .
    - git commit -m "auto commit" || echo "no changes to repo"
    # - git commit -m "auto commit [skip ci]" || echo "no changes to repo"
    - git push origin HEAD:$CI_COMMIT_REF_NAME || echo "no changes to repo"
  rules:
  - changes:
    - "**/*/*"