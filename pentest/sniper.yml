sniper:
  stage: .pre
  allow_failure: true
  interruptible: true
  image:
    name: donaldrich/pentest:latest
    entrypoint: [""]
  before_script:
    - sniper --help
  script:
    # - apt update && apt install -y fprobe whatweb jq wafw00f net-tools
    # sniper -c /full/path/to/sniper.conf -t <TARGET> -m <MODE> -w <WORKSPACE>
    - /bin/bash
    - sniper -t $PENTEST_TARGET -m $PENTEST_MODE -w $PENTEST_REPORT
    - sniper -w $PENTEST_REPORT --export
    - cp -r /usr/share/sniper/loot/workspace/$PENTEST_REPORT $CI_PROJECT_DIR/sniper
    - cp /usr/share/sniper/loot/$PENTEST_REPORT.tar $CI_PROJECT_DIR/sniper
  artifacts:
    name: "sniper"
    paths:
      - $CI_PROJECT_DIR/sniper/
      # - $CI_PROJECT_DIR/sniper-archive/
    when: always